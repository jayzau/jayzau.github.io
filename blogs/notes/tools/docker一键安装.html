<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jayzau</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="好劲!">
    
    <link rel="preload" href="/assets/css/0.styles.c0542458.css" as="style"><link rel="preload" href="/assets/js/app.c5305ee3.js" as="script"><link rel="preload" href="/assets/js/2.2733607c.js" as="script"><link rel="preload" href="/assets/js/18.25d28f03.js" as="script"><link rel="prefetch" href="/assets/js/10.ef8e919d.js"><link rel="prefetch" href="/assets/js/11.8ec9eea4.js"><link rel="prefetch" href="/assets/js/12.d902eacd.js"><link rel="prefetch" href="/assets/js/13.aec05fab.js"><link rel="prefetch" href="/assets/js/14.2805f5ea.js"><link rel="prefetch" href="/assets/js/15.8a264712.js"><link rel="prefetch" href="/assets/js/16.3b4138e0.js"><link rel="prefetch" href="/assets/js/17.eec3c406.js"><link rel="prefetch" href="/assets/js/19.090949aa.js"><link rel="prefetch" href="/assets/js/20.43c0a74c.js"><link rel="prefetch" href="/assets/js/21.f60ea17e.js"><link rel="prefetch" href="/assets/js/22.022efc2e.js"><link rel="prefetch" href="/assets/js/23.a3cee758.js"><link rel="prefetch" href="/assets/js/24.dfaf9b90.js"><link rel="prefetch" href="/assets/js/25.4bb80798.js"><link rel="prefetch" href="/assets/js/26.7dc791f1.js"><link rel="prefetch" href="/assets/js/27.b87628ec.js"><link rel="prefetch" href="/assets/js/28.b44871cc.js"><link rel="prefetch" href="/assets/js/29.ac371324.js"><link rel="prefetch" href="/assets/js/3.2241a300.js"><link rel="prefetch" href="/assets/js/30.c10170f6.js"><link rel="prefetch" href="/assets/js/31.ab3d6217.js"><link rel="prefetch" href="/assets/js/32.1e3fbc5c.js"><link rel="prefetch" href="/assets/js/33.13439f83.js"><link rel="prefetch" href="/assets/js/34.ee9bff09.js"><link rel="prefetch" href="/assets/js/35.b9fbcc7f.js"><link rel="prefetch" href="/assets/js/36.9293bf0b.js"><link rel="prefetch" href="/assets/js/37.71f16844.js"><link rel="prefetch" href="/assets/js/38.2c1388e6.js"><link rel="prefetch" href="/assets/js/4.5a3a6bf8.js"><link rel="prefetch" href="/assets/js/5.aad4954c.js"><link rel="prefetch" href="/assets/js/6.20be021d.js"><link rel="prefetch" href="/assets/js/7.5a1615ac.js"><link rel="prefetch" href="/assets/js/8.4f988748.js"><link rel="prefetch" href="/assets/js/9.e5f1a567.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0542458.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jayzau</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/notes/" class="nav-link router-link-active">
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/blogs/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/blogs/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blogs/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/blogs/go/" class="nav-link">
  Go
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jayzau" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/notes/" class="nav-link router-link-active">
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/blogs/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/blogs/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/blogs/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/blogs/go/" class="nav-link">
  Go
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jayzau" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>每次弄新服务器装环境很烦，今天找到一个只需要一条命令的好方法。</p> <p><a href="https://www.runoob.com/docker/ubuntu-docker-install.html" target="_blank" rel="noopener noreferrer">琅琊福地<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>命令如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://get.daocloud.io/docker <span class="token operator">|</span> <span class="token function">sh</span>
</code></pre></div><p>本机环境：</p> <blockquote><p>Ubuntu 16.04.6 LTS x86_64 GNU/Linux</p></blockquote> <hr> <p>源代码如下，空了再欣赏。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
<span class="token comment"># Docker CE for Linux installation script</span>
<span class="token comment">#</span>
<span class="token comment"># See https://docs.docker.com/install/ for the installation steps.</span>
<span class="token comment">#</span>
<span class="token comment"># This script is meant for quick &amp; easy install via:</span>
<span class="token comment">#   $ curl -fsSL https://get.docker.com -o get-docker.sh</span>
<span class="token comment">#   $ sh get-docker.sh</span>
<span class="token comment">#</span>
<span class="token comment"># For test builds (ie. release candidates):</span>
<span class="token comment">#   $ curl -fsSL https://test.docker.com -o test-docker.sh</span>
<span class="token comment">#   $ sh test-docker.sh</span>
<span class="token comment">#</span>
<span class="token comment"># NOTE: Make sure to verify the contents of the script</span>
<span class="token comment">#       you downloaded matches the contents of install.sh</span>
<span class="token comment">#       located at https://github.com/docker/docker-install</span>
<span class="token comment">#       before executing.</span>
<span class="token comment">#</span>
<span class="token comment"># Git commit from https://github.com/docker/docker-install when</span>
<span class="token comment"># the script was uploaded (Should only be modified by upload job):</span>
<span class="token assign-left variable">SCRIPT_COMMIT_SHA</span><span class="token operator">=</span><span class="token string">&quot;26ff363bcf3b3f5a00498ac43694bf1c7d9ce16c&quot;</span>


<span class="token comment"># The channel to install from:</span>
<span class="token comment">#   * nightly</span>
<span class="token comment">#   * test</span>
<span class="token comment">#   * stable</span>
<span class="token comment">#   * edge (deprecated)</span>
<span class="token assign-left variable">DEFAULT_CHANNEL_VALUE</span><span class="token operator">=</span><span class="token string">&quot;stable&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$CHANNEL</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable">CHANNEL</span><span class="token operator">=</span><span class="token variable">$DEFAULT_CHANNEL_VALUE</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">DEFAULT_DOWNLOAD_URL</span><span class="token operator">=</span><span class="token string">&quot;https://download.docker.com&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$DOWNLOAD_URL</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable">DOWNLOAD_URL</span><span class="token operator">=</span><span class="token variable">$DEFAULT_DOWNLOAD_URL</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">DEFAULT_REPO_FILE</span><span class="token operator">=</span><span class="token string">&quot;docker-ce.repo&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$REPO_FILE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable">REPO_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$DEFAULT_REPO_FILE</span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">mirror</span><span class="token operator">=</span><span class="token string">''</span>
<span class="token assign-left variable">DRY_RUN</span><span class="token operator">=</span><span class="token variable">${DRY_RUN<span class="token operator">:-</span>}</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token keyword">in</span>
		--mirror<span class="token punctuation">)</span>
			<span class="token assign-left variable">mirror</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span>
			<span class="token builtin class-name">shift</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		--dry-run<span class="token punctuation">)</span>
			<span class="token assign-left variable">DRY_RUN</span><span class="token operator">=</span><span class="token number">1</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		--*<span class="token punctuation">)</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot;Illegal option <span class="token variable">$1</span>&quot;</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token keyword">esac</span>
	<span class="token builtin class-name">shift</span> <span class="token variable"><span class="token variable">$((</span> $# <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span> <span class="token variable">))</span></span>
<span class="token keyword">done</span>

<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$mirror</span>&quot;</span> <span class="token keyword">in</span>
	Aliyun<span class="token punctuation">)</span>
		<span class="token assign-left variable">DOWNLOAD_URL</span><span class="token operator">=</span><span class="token string">&quot;https://mirrors.aliyun.com/docker-ce&quot;</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
	AzureChinaCloud<span class="token punctuation">)</span>
		<span class="token assign-left variable">DOWNLOAD_URL</span><span class="token operator">=</span><span class="token string">&quot;https://mirror.azure.cn/docker-ce&quot;</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>

<span class="token function-name function">command_exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token punctuation">}</span>

<span class="token function-name function">is_dry_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$DRY_RUN</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token builtin class-name">return</span> <span class="token number">1</span>
	<span class="token keyword">else</span>
		<span class="token builtin class-name">return</span> <span class="token number">0</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">is_wsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>&quot;</span> <span class="token keyword">in</span>
	*microsoft* <span class="token punctuation">)</span> <span class="token boolean">true</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment"># WSL 2</span>
	*Microsoft* <span class="token punctuation">)</span> <span class="token boolean">true</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token comment"># WSL 1</span>
	* <span class="token punctuation">)</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token keyword">esac</span>
<span class="token punctuation">}</span>

<span class="token function-name function">is_darwin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>&quot;</span> <span class="token keyword">in</span>
	*darwin* <span class="token punctuation">)</span> <span class="token boolean">true</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
	*Darwin* <span class="token punctuation">)</span> <span class="token boolean">true</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
	* <span class="token punctuation">)</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token keyword">esac</span>
<span class="token punctuation">}</span>

<span class="token function-name function">deprecation_notice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">distro</span><span class="token operator">=</span><span class="token variable">$1</span>
	<span class="token assign-left variable">date</span><span class="token operator">=</span><span class="token variable">$2</span>
	<span class="token builtin class-name">echo</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;DEPRECATION WARNING:&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;    The distribution, <span class="token variable">$distro</span>, will no longer be supported in this script as of <span class="token variable">$date</span>.&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;    If you feel this is a mistake please submit an issue at https://github.com/docker/docker-install/issues/new&quot;</span>
	<span class="token builtin class-name">echo</span>
	<span class="token function">sleep</span> <span class="token number">10</span>
<span class="token punctuation">}</span>

<span class="token function-name function">get_distribution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">lsb_dist</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
	<span class="token comment"># Every system that we officially support has /etc/os-release</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-r</span> /etc/os-release <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token assign-left variable">lsb_dist</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$ID</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
	<span class="token keyword">fi</span>
	<span class="token comment"># Returning an empty string here should be alright since the</span>
	<span class="token comment"># case statements don't act unless you provide an actual value</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">add_debian_backport_repo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">debian_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
	<span class="token assign-left variable">backports</span><span class="token operator">=</span><span class="token string">&quot;deb http://ftp.debian.org/debian <span class="token variable">$debian_version</span>-backports main&quot;</span>
	<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">grep</span> <span class="token parameter variable">-Fxq</span> <span class="token string">&quot;<span class="token variable">$backports</span>&quot;</span> /etc/apt/sources.list<span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token punctuation">(</span>set -x<span class="token punctuation">;</span> <span class="token variable">$sh_c</span> <span class="token string">&quot;echo <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">$backports</span><span class="token entity" title="\&quot;">\&quot;</span> &gt;&gt; /etc/apt/sources.list&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">echo_docker_as_nonroot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token builtin class-name">return</span>
	<span class="token keyword">fi</span>
	<span class="token keyword">if</span> command_exists <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> /var/run/docker.sock <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token punctuation">(</span>
			<span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>
			<span class="token variable">$sh_c</span> <span class="token string">'docker version'</span>
		<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token boolean">true</span>
	<span class="token keyword">fi</span>
	<span class="token assign-left variable">your_user</span><span class="token operator">=</span>your-user
	<span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$user</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">'root'</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">your_user</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$user</span>&quot;</span>
	<span class="token comment"># intentionally mixed spaces and tabs here -- tabs are stripped by &quot;&lt;&lt;-EOF&quot;, spaces are kept in the output</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;If you would like to use Docker as a non-root user, you should now consider&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;adding your user to the <span class="token entity" title="\&quot;">\&quot;</span>docker<span class="token entity" title="\&quot;">\&quot;</span> group with something like:&quot;</span>
	<span class="token builtin class-name">echo</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;  sudo usermod -aG docker <span class="token variable">$your_user</span>&quot;</span>
	<span class="token builtin class-name">echo</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;Remember that you will have to log out and back in for this to take effect!&quot;</span>
	<span class="token builtin class-name">echo</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;WARNING: Adding a user to the <span class="token entity" title="\&quot;">\&quot;</span>docker<span class="token entity" title="\&quot;">\&quot;</span> group will grant the ability to run&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;         containers which can be used to obtain root privileges on the&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;         docker host.&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;         Refer to https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;         for more information.&quot;</span>

<span class="token punctuation">}</span>

<span class="token comment"># Check if this is a forked Linux distro</span>
<span class="token function-name function">check_forked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment"># Check for lsb_release command existence, it usually exists in forked distros</span>
	<span class="token keyword">if</span> command_exists lsb_release<span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># Check if the `-u` option is supported</span>
		<span class="token builtin class-name">set</span> +e
		lsb_release <span class="token parameter variable">-a</span> <span class="token parameter variable">-u</span> <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
		<span class="token assign-left variable">lsb_release_exit_code</span><span class="token operator">=</span><span class="token variable">$?</span>
		<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

		<span class="token comment"># Check if the command has exited successfully, it means we're in a forked distro</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$lsb_release_exit_code</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token comment"># Print info about current distro</span>
			<span class="token function">cat</span> <span class="token operator">&lt;&lt;-</span>EOF
			You<span class="token string">'re using '</span><span class="token variable">$lsb_dist</span><span class="token string">' version '</span><span class="token variable">$dist_version</span><span class="token string">'.
			EOF

			# Get the upstream release info
			lsb_dist=$(lsb_release -a -u 2&gt;&amp;1 | tr '</span><span class="token punctuation">[</span>:upper:<span class="token punctuation">]</span><span class="token string">' '</span><span class="token punctuation">[</span>:lower:<span class="token punctuation">]</span><span class="token string">' | grep -E '</span><span class="token function">id</span><span class="token string">' | cut -d '</span><span class="token builtin class-name">:</span><span class="token string">' -f 2 | tr -d '</span><span class="token punctuation">[</span>:space:<span class="token punctuation">]</span><span class="token string">')
			dist_version=$(lsb_release -a -u 2&gt;&amp;1 | tr '</span><span class="token punctuation">[</span>:upper:<span class="token punctuation">]</span><span class="token string">' '</span><span class="token punctuation">[</span>:lower:<span class="token punctuation">]</span><span class="token string">' | grep -E '</span>codename<span class="token string">' | cut -d '</span><span class="token builtin class-name">:</span><span class="token string">' -f 2 | tr -d '</span><span class="token punctuation">[</span>:space:<span class="token punctuation">]</span><span class="token string">')

			# Print info about upstream distro
			cat &lt;&lt;-EOF
			Upstream release is '</span><span class="token variable">$lsb_dist</span><span class="token string">' version '</span><span class="token variable">$dist_version</span><span class="token string">'.
			EOF
		else
			if [ -r /etc/debian_version ] &amp;&amp; [ &quot;$lsb_dist&quot; != &quot;ubuntu&quot; ] &amp;&amp; [ &quot;$lsb_dist&quot; != &quot;raspbian&quot; ]; then
				if [ &quot;$lsb_dist&quot; = &quot;osmc&quot; ]; then
					# OSMC runs Raspbian
					lsb_dist=raspbian
				else
					# We'</span>re Debian and don<span class="token string">'t even know it!
					lsb_dist=debian
				fi
				dist_version=&quot;$(sed '</span>s/<span class="token punctuation">\</span>/.*//<span class="token string">' /etc/debian_version | sed '</span>s/<span class="token punctuation">\</span><span class="token punctuation">..</span>*//<span class="token string">')&quot;
				case &quot;$dist_version&quot; in
					10)
						dist_version=&quot;buster&quot;
					;;
					9)
						dist_version=&quot;stretch&quot;
					;;
					8|'</span>Kali Linux <span class="token number">2</span><span class="token string">')
						dist_version=&quot;jessie&quot;
					;;
				esac
			fi
		fi
	fi
}

semverParse() {
	major=&quot;${1%%.*}&quot;
	minor=&quot;${1#$major.}&quot;
	minor=&quot;${minor%%.*}&quot;
	patch=&quot;${1#$major.$minor.}&quot;
	patch=&quot;${patch%%[-.]*}&quot;
}

do_install() {
	echo &quot;# Executing docker install script, commit: $SCRIPT_COMMIT_SHA&quot;

	if command_exists docker; then
		docker_version=&quot;$(docker -v | cut -d '</span> <span class="token string">' -f3 | cut -d '</span>,<span class="token string">' -f1)&quot;
		MAJOR_W=1
		MINOR_W=10

		semverParse &quot;$docker_version&quot;

		shouldWarn=0
		if [ &quot;$major&quot; -lt &quot;$MAJOR_W&quot; ]; then
			shouldWarn=1
		fi

		if [ &quot;$major&quot; -le &quot;$MAJOR_W&quot; ] &amp;&amp; [ &quot;$minor&quot; -lt &quot;$MINOR_W&quot; ]; then
			shouldWarn=1
		fi

		cat &gt;&amp;2 &lt;&lt;-'</span>EOF<span class="token string">'
			Warning: the &quot;docker&quot; command appears to already exist on this system.

			If you already have Docker installed, this script can cause trouble, which is
			why we'</span>re displaying this warning and provide the opportunity to cancel the
			installation.

			If you installed the current Docker package using this script and are using it
		EOF

		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$shouldWarn</span> <span class="token parameter variable">-eq</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token function">cat</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'</span>
			again to update Docker, we urge you to migrate your image store before upgrading
			to v1.10+.

			You can <span class="token function">find</span> instructions <span class="token keyword">for</span> this here:
			https://github.com/docker/docker/wiki/Engine-v1.10.0-content-addressability-migration
			EOF
		<span class="token keyword">else</span>
			<span class="token function">cat</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'</span>
			again to update Docker, you can safely ignore this message.
			EOF
		<span class="token keyword">fi</span>

		<span class="token function">cat</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'</span>

			You may press Ctrl+C now to abort this script.
		EOF
		<span class="token punctuation">(</span> <span class="token builtin class-name">set</span> -x<span class="token punctuation">;</span> <span class="token function">sleep</span> <span class="token number">20</span> <span class="token punctuation">)</span>
	<span class="token keyword">fi</span>

	<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-un</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token boolean">true</span><span class="token variable">)</span></span>&quot;</span>

	<span class="token assign-left variable">sh_c</span><span class="token operator">=</span><span class="token string">'sh -c'</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$user</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">'root'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token keyword">if</span> command_exists <span class="token function">sudo</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token assign-left variable">sh_c</span><span class="token operator">=</span><span class="token string">'sudo -E sh -c'</span>
		<span class="token keyword">elif</span> command_exists <span class="token function">su</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token assign-left variable">sh_c</span><span class="token operator">=</span><span class="token string">'su -c'</span>
		<span class="token keyword">else</span>
			<span class="token function">cat</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'</span>
			Error: this installer needs the ability to run commands as root.
			We are unable to <span class="token function">find</span> either <span class="token string">&quot;sudo&quot;</span> or <span class="token string">&quot;su&quot;</span> available to <span class="token function">make</span> this happen.
			EOF
			<span class="token builtin class-name">exit</span> <span class="token number">1</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">fi</span>

	<span class="token keyword">if</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token assign-left variable">sh_c</span><span class="token operator">=</span><span class="token string">&quot;echo&quot;</span>
	<span class="token keyword">fi</span>

	<span class="token comment"># perform some very rudimentary platform detection</span>
	<span class="token assign-left variable">lsb_dist</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> get_distribution <span class="token variable">)</span></span>
	<span class="token assign-left variable">lsb_dist</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'[:upper:]'</span> <span class="token string">'[:lower:]'</span><span class="token variable">)</span></span>&quot;</span>

	<span class="token keyword">if</span> is_wsl<span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token builtin class-name">echo</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;WSL DETECTED: We recommend using Docker Desktop for Windows.&quot;</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;Please get Docker Desktop from https://www.docker.com/products/docker-desktop&quot;</span>
		<span class="token builtin class-name">echo</span>
		<span class="token function">cat</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'</span>

			You may press Ctrl+C now to abort this script.
		EOF
		<span class="token punctuation">(</span> <span class="token builtin class-name">set</span> -x<span class="token punctuation">;</span> <span class="token function">sleep</span> <span class="token number">20</span> <span class="token punctuation">)</span>
	<span class="token keyword">fi</span>

	<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span> <span class="token keyword">in</span>

		ubuntu<span class="token punctuation">)</span>
			<span class="token keyword">if</span> command_exists lsb_release<span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">--codename</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f2</span><span class="token variable">)</span></span>&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$dist_version</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token parameter variable">-r</span> /etc/lsb-release <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/lsb-release <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$DISTRIB_CODENAME</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
			<span class="token keyword">fi</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>

		debian<span class="token operator">|</span>raspbian<span class="token punctuation">)</span>
			<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">sed</span> <span class="token string">'s/\/.*//'</span> /etc/debian_version <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\..*//'</span><span class="token variable">)</span></span>&quot;</span>
			<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$dist_version</span>&quot;</span> <span class="token keyword">in</span>
				<span class="token number">10</span><span class="token punctuation">)</span>
					<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;buster&quot;</span>
				<span class="token punctuation">;</span><span class="token punctuation">;</span>
				<span class="token number">9</span><span class="token punctuation">)</span>
					<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;stretch&quot;</span>
				<span class="token punctuation">;</span><span class="token punctuation">;</span>
				<span class="token number">8</span><span class="token punctuation">)</span>
					<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;jessie&quot;</span>
				<span class="token punctuation">;</span><span class="token punctuation">;</span>
			<span class="token keyword">esac</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>

		centos<span class="token operator">|</span>rhel<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$dist_version</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token parameter variable">-r</span> /etc/os-release <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$VERSION_ID</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
			<span class="token keyword">fi</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>

		*<span class="token punctuation">)</span>
			<span class="token keyword">if</span> command_exists lsb_release<span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">--release</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f2</span><span class="token variable">)</span></span>&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$dist_version</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token parameter variable">-r</span> /etc/os-release <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">dist_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$VERSION_ID</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
			<span class="token keyword">fi</span>
		<span class="token punctuation">;</span><span class="token punctuation">;</span>

	<span class="token keyword">esac</span>

	<span class="token comment"># Check if this is a forked Linux distro</span>
	check_forked

	<span class="token comment"># Run setup for each distro accordingly</span>
	<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span> <span class="token keyword">in</span>
		ubuntu<span class="token operator">|</span>debian<span class="token operator">|</span>raspbian<span class="token punctuation">)</span>
			<span class="token assign-left variable">pre_reqs</span><span class="token operator">=</span><span class="token string">&quot;apt-transport-https ca-certificates curl&quot;</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;debian&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token comment"># libseccomp2 does not exist for debian jessie main repos for aarch64</span>
				<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;aarch64&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$dist_version</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;jessie&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
					add_debian_backport_repo <span class="token string">&quot;<span class="token variable">$dist_version</span>&quot;</span>
				<span class="token keyword">fi</span>
			<span class="token keyword">fi</span>

			<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> gpg <span class="token operator">&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">pre_reqs</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$pre_reqs</span> gnupg&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token assign-left variable">apt_repo</span><span class="token operator">=</span><span class="token string">&quot;deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span>] <span class="token variable">$DOWNLOAD_URL</span>/linux/<span class="token variable">$lsb_dist</span> <span class="token variable">$dist_version</span> <span class="token variable">$CHANNEL</span>&quot;</span>
			<span class="token punctuation">(</span>
				<span class="token keyword">if</span> <span class="token operator">!</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>
				<span class="token keyword">fi</span>
				<span class="token variable">$sh_c</span> <span class="token string">'apt-get update -qq &gt;/dev/null'</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;DEBIAN_FRONTEND=noninteractive apt-get install -y -qq <span class="token variable">$pre_reqs</span> &gt;/dev/null&quot;</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;curl -fsSL <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">$DOWNLOAD_URL</span>/linux/<span class="token variable">$lsb_dist</span>/gpg<span class="token entity" title="\&quot;">\&quot;</span> | apt-key add -qq - &gt;/dev/null&quot;</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;echo <span class="token entity" title="\&quot;">\&quot;</span><span class="token variable">$apt_repo</span><span class="token entity" title="\&quot;">\&quot;</span> &gt; /etc/apt/sources.list.d/docker.list&quot;</span>
				<span class="token variable">$sh_c</span> <span class="token string">'apt-get update -qq &gt;/dev/null'</span>
			<span class="token punctuation">)</span>
			<span class="token assign-left variable">pkg_version</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token keyword">if</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;# WARNING: VERSION pinning is not supported in DRY_RUN&quot;</span>
				<span class="token keyword">else</span>
					<span class="token comment"># Will work for incomplete versions IE (17.12), but may not actually grab the &quot;latest&quot; if in the test channel</span>
					<span class="token assign-left variable">pkg_pattern</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;s/-ce-/~ce~.*/g&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;s/-/.*/g&quot;</span><span class="token variable">)</span></span>.*-0~<span class="token variable">$lsb_dist</span>&quot;</span>
					<span class="token assign-left variable">search_command</span><span class="token operator">=</span><span class="token string">&quot;apt-cache madison 'docker-ce' | grep '<span class="token variable">$pkg_pattern</span>' | head -1 | awk '{\<span class="token variable">$1</span>=\<span class="token variable">$1</span>};1' | cut -d' ' -f 3&quot;</span>
					<span class="token assign-left variable">pkg_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>$sh_c <span class="token string">&quot;<span class="token variable">$search_command</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;INFO: Searching repository for VERSION '<span class="token variable">$VERSION</span>'&quot;</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;INFO: <span class="token variable">$search_command</span>&quot;</span>
					<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$pkg_version</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
						<span class="token builtin class-name">echo</span>
						<span class="token builtin class-name">echo</span> <span class="token string">&quot;ERROR: '<span class="token variable">$VERSION</span>' not found amongst apt-cache madison results&quot;</span>
						<span class="token builtin class-name">echo</span>
						<span class="token builtin class-name">exit</span> <span class="token number">1</span>
					<span class="token keyword">fi</span>
					<span class="token assign-left variable">search_command</span><span class="token operator">=</span><span class="token string">&quot;apt-cache madison 'docker-ce-cli' | grep '<span class="token variable">$pkg_pattern</span>' | head -1 | awk '{\<span class="token variable">$1</span>=\<span class="token variable">$1</span>};1' | cut -d' ' -f 3&quot;</span>
					<span class="token comment"># Don't insert an = for cli_pkg_version, we'll just include it later</span>
					<span class="token assign-left variable">cli_pkg_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>$sh_c <span class="token string">&quot;<span class="token variable">$search_command</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
					<span class="token assign-left variable">pkg_version</span><span class="token operator">=</span><span class="token string">&quot;=<span class="token variable">$pkg_version</span>&quot;</span>
				<span class="token keyword">fi</span>
			<span class="token keyword">fi</span>
			<span class="token punctuation">(</span>
				<span class="token keyword">if</span> <span class="token operator">!</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>
				<span class="token keyword">fi</span>
				<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$cli_pkg_version</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token variable">$sh_c</span> <span class="token string">&quot;apt-get install -y -qq --no-install-recommends docker-ce-cli=<span class="token variable">$cli_pkg_version</span> &gt;/dev/null&quot;</span>
				<span class="token keyword">fi</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;apt-get install -y -qq --no-install-recommends docker-ce<span class="token variable">$pkg_version</span> &gt;/dev/null&quot;</span>
			<span class="token punctuation">)</span>
			echo_docker_as_nonroot
			<span class="token builtin class-name">exit</span> <span class="token number">0</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		centos<span class="token operator">|</span>fedora<span class="token operator">|</span>rhel<span class="token punctuation">)</span>
			<span class="token assign-left variable">yum_repo</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$DOWNLOAD_URL</span>/linux/<span class="token variable">$lsb_dist</span>/<span class="token variable">$REPO_FILE</span>&quot;</span>
			<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">curl</span> <span class="token parameter variable">-Ifs</span> <span class="token string">&quot;<span class="token variable">$yum_repo</span>&quot;</span> <span class="token operator">&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token builtin class-name">echo</span> <span class="token string">&quot;Error: Unable to curl repository file <span class="token variable">$yum_repo</span>, is it valid?&quot;</span>
				<span class="token builtin class-name">exit</span> <span class="token number">1</span>
			<span class="token keyword">fi</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;fedora&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">pkg_manager</span><span class="token operator">=</span><span class="token string">&quot;dnf&quot;</span>
				<span class="token assign-left variable">config_manager</span><span class="token operator">=</span><span class="token string">&quot;dnf config-manager&quot;</span>
				<span class="token assign-left variable">enable_channel_flag</span><span class="token operator">=</span><span class="token string">&quot;--set-enabled&quot;</span>
				<span class="token assign-left variable">disable_channel_flag</span><span class="token operator">=</span><span class="token string">&quot;--set-disabled&quot;</span>
				<span class="token assign-left variable">pre_reqs</span><span class="token operator">=</span><span class="token string">&quot;dnf-plugins-core&quot;</span>
				<span class="token assign-left variable">pkg_suffix</span><span class="token operator">=</span><span class="token string">&quot;fc<span class="token variable">$dist_version</span>&quot;</span>
			<span class="token keyword">else</span>
				<span class="token assign-left variable">pkg_manager</span><span class="token operator">=</span><span class="token string">&quot;yum&quot;</span>
				<span class="token assign-left variable">config_manager</span><span class="token operator">=</span><span class="token string">&quot;yum-config-manager&quot;</span>
				<span class="token assign-left variable">enable_channel_flag</span><span class="token operator">=</span><span class="token string">&quot;--enable&quot;</span>
				<span class="token assign-left variable">disable_channel_flag</span><span class="token operator">=</span><span class="token string">&quot;--disable&quot;</span>
				<span class="token assign-left variable">pre_reqs</span><span class="token operator">=</span><span class="token string">&quot;yum-utils&quot;</span>
				<span class="token assign-left variable">pkg_suffix</span><span class="token operator">=</span><span class="token string">&quot;el&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token punctuation">(</span>
				<span class="token keyword">if</span> <span class="token operator">!</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>
				<span class="token keyword">fi</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$pkg_manager</span> install -y -q <span class="token variable">$pre_reqs</span>&quot;</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$config_manager</span> --add-repo <span class="token variable">$yum_repo</span>&quot;</span>

				<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$CHANNEL</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;stable&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$config_manager</span> <span class="token variable">$disable_channel_flag</span> docker-ce-*&quot;</span>
					<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$config_manager</span> <span class="token variable">$enable_channel_flag</span> docker-ce-<span class="token variable">$CHANNEL</span>&quot;</span>
				<span class="token keyword">fi</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$pkg_manager</span> makecache&quot;</span>
			<span class="token punctuation">)</span>
			<span class="token assign-left variable">pkg_version</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token keyword">if</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;# WARNING: VERSION pinning is not supported in DRY_RUN&quot;</span>
				<span class="token keyword">else</span>
					<span class="token assign-left variable">pkg_pattern</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;s/-ce-/<span class="token entity" title="\\">\\</span><span class="token entity" title="\\">\\</span>.ce.*/g&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;s/-/.*/g&quot;</span><span class="token variable">)</span></span>.*<span class="token variable">$pkg_suffix</span>&quot;</span>
					<span class="token assign-left variable">search_command</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$pkg_manager</span> list --showduplicates 'docker-ce' | grep '<span class="token variable">$pkg_pattern</span>' | tail -1 | awk '{print \<span class="token variable">$2</span>}'&quot;</span>
					<span class="token assign-left variable">pkg_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>$sh_c <span class="token string">&quot;<span class="token variable">$search_command</span>&quot;</span><span class="token variable">)</span></span>&quot;</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;INFO: Searching repository for VERSION '<span class="token variable">$VERSION</span>'&quot;</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;INFO: <span class="token variable">$search_command</span>&quot;</span>
					<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$pkg_version</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
						<span class="token builtin class-name">echo</span>
						<span class="token builtin class-name">echo</span> <span class="token string">&quot;ERROR: '<span class="token variable">$VERSION</span>' not found amongst <span class="token variable">$pkg_manager</span> list results&quot;</span>
						<span class="token builtin class-name">echo</span>
						<span class="token builtin class-name">exit</span> <span class="token number">1</span>
					<span class="token keyword">fi</span>
					<span class="token assign-left variable">search_command</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$pkg_manager</span> list --showduplicates 'docker-ce-cli' | grep '<span class="token variable">$pkg_pattern</span>' | tail -1 | awk '{print \<span class="token variable">$2</span>}'&quot;</span>
					<span class="token comment"># It's okay for cli_pkg_version to be blank, since older versions don't support a cli package</span>
					<span class="token assign-left variable">cli_pkg_version</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>$sh_c <span class="token string">&quot;<span class="token variable">$search_command</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">':'</span> <span class="token parameter variable">-f</span> <span class="token number">2</span><span class="token variable">)</span></span>&quot;</span>
					<span class="token comment"># Cut out the epoch and prefix with a '-'</span>
					<span class="token assign-left variable">pkg_version</span><span class="token operator">=</span><span class="token string">&quot;-<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$pkg_version</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">':'</span> <span class="token parameter variable">-f</span> <span class="token number">2</span><span class="token variable">)</span></span>&quot;</span>
				<span class="token keyword">fi</span>
			<span class="token keyword">fi</span>
			<span class="token punctuation">(</span>
				<span class="token keyword">if</span> <span class="token operator">!</span> is_dry_run<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>
				<span class="token keyword">fi</span>
				<span class="token comment"># install the correct cli version first</span>
				<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$cli_pkg_version</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$pkg_manager</span> install -y -q docker-ce-cli-<span class="token variable">$cli_pkg_version</span>&quot;</span>
				<span class="token keyword">fi</span>
				<span class="token variable">$sh_c</span> <span class="token string">&quot;<span class="token variable">$pkg_manager</span> install -y -q docker-ce<span class="token variable">$pkg_version</span>&quot;</span>
			<span class="token punctuation">)</span>
			echo_docker_as_nonroot
			<span class="token builtin class-name">exit</span> <span class="token number">0</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		*<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$lsb_dist</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token keyword">if</span> is_darwin<span class="token punctuation">;</span> <span class="token keyword">then</span>
					<span class="token builtin class-name">echo</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;ERROR: Unsupported operating system 'macOS'&quot;</span>
					<span class="token builtin class-name">echo</span> <span class="token string">&quot;Please get Docker Desktop from https://www.docker.com/products/docker-desktop&quot;</span>
					<span class="token builtin class-name">echo</span>
					<span class="token builtin class-name">exit</span> <span class="token number">1</span>
				<span class="token keyword">fi</span>
			<span class="token keyword">fi</span>
			<span class="token builtin class-name">echo</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot;ERROR: Unsupported distribution '<span class="token variable">$lsb_dist</span>'&quot;</span>
			<span class="token builtin class-name">echo</span>
			<span class="token builtin class-name">exit</span> <span class="token number">1</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token keyword">esac</span>
	<span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment"># wrapped up in a function so that we have some protection against only getting</span>
<span class="token comment"># half the file during &quot;curl | sh&quot;</span>
do_install
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上一次编辑于:</span> <span class="time">3/10/2023, 4:39:40 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c5305ee3.js" defer></script><script src="/assets/js/2.2733607c.js" defer></script><script src="/assets/js/18.25d28f03.js" defer></script>
  </body>
</html>
